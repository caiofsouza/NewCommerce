"use strict";var API_HOST="http://localhost:3000/api/",app=angular.module("newCommerce",["ui.router","ngCookies"]);app.config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$stateProvider.state("login",{url:"/login",templateUrl:"public/views/login.html",data:{requireToken:!1}}).state("home",{url:"/home",templateUrl:"public/views/home.html",data:{requireToken:!0}}),$urlRouterProvider.otherwise("/home")}]),app.run(["$rootScope","$state","$cookies",function($rootScope,$state,$cookies){$rootScope.$on("$stateChangeStart",function(event,toState,toParams){var session_obj=void 0!=$cookies.get("api_auth")?$cookies.get("api_auth"):null,token=null!=session_obj?session_obj.token:null,requireToken=toState.data.requireToken;console.log(session_obj,toState,token),!requireToken||void 0!=token&&null!=token&&""!=token?"login"==toState.name&&void 0!=token&&(console.log("ESLE2"),$state.go("home")):(event.preventDefault(),console.log("IF1"),$state.go("login"))})}]),app.controller("HomeCtrl",[function(){this.message="teste"}]),app.controller("LoginCtrl",["$location","Auth","$http",function($location,Auth,$http){this.user_email="",this.user_password="",this.auth=new Auth,this.user_login=function(){if(this.messageError="",""!=this.user_email&&""!=this.user_password){this.email_error=this.pass_error=!1;var user_obj={username:this.user_email,password:this.user_password};this.auth.loginUser(user_obj,function(result){console.log("resultado: "+result),1==result?$location.path("/home"):this.messageError="Usu√°rio ou senha incorretos!"})}else""==this.user_email?(this.email_error=!0,this.messageError="Preencha o campo de email"):(this.pass_error=!0,this.messageError="Preencha o campo de senha")}}]),app.controller("MenuCtrl",[function($scope){this.user={name:"Caio Fernandes",email:"caio_fsouza@hotmail.com",active:!0}}]),app.controller("ProductCtrl",["$routeParams",function($routeParams){this.product_id=$routeParams.product_id,this.message="Product page"}]),app.factory("Auth",["$http","$location","$cookies",function($http,$location,$cookies){function Auth(){this.token=""}return Auth.prototype={loginUser:function(user_obj,callback){$http({method:"POST",url:API_HOST+"login/",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(obj){var str=[];for(var p in obj)str.push(encodeURIComponent(p)+"="+encodeURIComponent(obj[p]));return str.join("&")},data:{username:user_obj.username,password:user_obj.password}}).then(function(response){return $cookies=response.data,app.run(["$http",function($http){$http.defaults.headers.common["x-access-token"]=response.data.token}]),!0},function(response){return!1})}},Auth}]);