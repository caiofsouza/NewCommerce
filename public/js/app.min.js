"use strict";var API_HOST="http://localhost:3000/api/",app=angular.module("newCommerce",["ngRoute","ngCookies"]);app.config(["$locationProvider","$routeProvider",function($locationProvider,$routeProvider){$routeProvider.when("/",{templateUrl:"views/login.html",controller:"LoginCtrl",needAuth:!1}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl",needAuth:!1}).when("/home",{templateUrl:"views/home.html",controller:"HomeCtrl",needAuth:!0}).when("/products",{templateUrl:"views/products.html",controller:"ProductsCtrl",needAuth:!0}).when("/product",{templateUrl:"views/product.html",controller:"ProductCtrl",needAuth:!0}),$routeProvider.otherwise({redirectTo:"/home"}),$locationProvider.html5Mode(!0)}]),app.run(["$rootScope","$cookies","$location","$route","$timeout",function($rootScope,$cookies,$location,$route,$timeout){$rootScope.$on("$routeChangeStart",function(event,next,current){var session_obj=void 0!=$cookies.get("api_auth")?JSON.parse($cookies.get("api_auth")):void 0,token=void 0!=session_obj?session_obj.token:void 0,nextPath=$location.path();$route.routes[nextPath];1==next.needAuth&&void 0==token?$location.path("/login"):"/login"==nextPath&&void 0!=token&&$location.path("/home")})}]),app.controller("HomeCtrl",["$cookies",function($cookies){this.user=JSON.parse($cookies.get("api_auth")).user}]),app.controller("LoginCtrl",["$location","Auth","$http",function($location,Auth,$http){var self=this;self.user_email="",self.user_password="",self.auth=new Auth,self.user_login=function(){if(self.messageError="",""!=self.user_email&&""!=self.user_password){self.email_error=self.pass_error=!1;var user_obj={username:self.user_email,password:self.user_password};self.auth.loginUser(user_obj,function(result){1==result?$location.path("/home").replace():self.messageError="Usu√°rio ou senha incorretos!"})}else""==self.user_email?(self.email_error=!0,self.messageError="Preencha o campo de email"):(self.pass_error=!0,self.messageError="Preencha o campo de senha")}}]),app.controller("ProductCtrl",["$routeParams",function($routeParams){this.user=JSON.parse($cookies.get("api_auth")).user,this.product_id=$routeParams.product_id,this.message="Product page"}]),app.controller("ProductsCtrl",["$cookies",function($cookies){this.user=JSON.parse($cookies.get("api_auth")).user}]),app.factory("Auth",["$http","$location","$cookies",function($http,$location,$cookies){function Auth(){this.token=""}return Auth.prototype={loginUser:function(user_obj,fncallback){$http({method:"POST",url:API_HOST+"login/",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(obj){var str=[];for(var p in obj)str.push(encodeURIComponent(p)+"="+encodeURIComponent(obj[p]));return str.join("&")},data:{username:user_obj.username,password:user_obj.password}}).then(function(response){$cookies.put("api_auth",JSON.stringify(response.data)),app.run(["$http",function($http){$http.defaults.headers.common["x-access-token"]=response.data.token}]),void 0!=fncallback&&fncallback(!0)},function(response){void 0!=fncallback&&fncallback(!1)})}},Auth}]);